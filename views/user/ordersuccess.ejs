<%- include('../partials/header.ejs') %>
<link
  href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  rel="stylesheet"
/>
<style>
  body {
    background-color: #f8f9fa;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  }

  .success-container {
    padding: 40px 0;
  }

  .success-card {
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    padding: 30px;
    margin-bottom: 25px;
    transition: all 0.3s ease;
  }

  .success-card:hover {
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
  }

  .section-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #333;
    margin-bottom: 25px;
    padding-bottom: 10px;
    border-bottom: 2px solid #ffc107;
    display: inline-block;
  }

  .success-icon {
    font-size: 4rem;
    color: #28a745;
    margin-bottom: 20px;
  }

  .order-id {
    background-color: #f8f9fa;
    padding: 10px 15px;
    border-radius: 5px;
    margin: 15px 0;
    font-family: monospace;
    font-size: 1.1rem;
  }

  .order-details-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: #333;
    margin: 20px 0 15px;
  }

  .order-item {
    display: flex;
    align-items: center;
    padding: 15px 0;
    border-bottom: 1px solid #eee;
  }

  .product-image {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 5px;
    margin-right: 15px;
  }

  .product-details {
    flex-grow: 1;
  }

  .product-name {
    font-size: 16px;
    font-weight: 500;
    margin-bottom: 3px;
    color: #333;
  }

  .product-price {
    font-size: 16px;
    font-weight: 600;
    color: #007bff;
    white-space: nowrap;
  }

  .info-row {
    margin-bottom: 8px;
  }

  .info-label {
    font-weight: 600;
    color: #555;
  }

  .address-box {
    background-color: #f8f9fa;
    padding: 15px;
    border-radius: 5px;
    margin-top: 10px;
  }

  .order-summary-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    color: #555;
  }

  .total-row {
    font-size: 18px;
    font-weight: 600;
    color: #333;
    padding-top: 10px;
    margin-top: 5px;
    border-top: 2px dashed #eee;
  }

  .action-btn {
    padding: 10px 20px;
    border-radius: 5px;
    font-weight: 500;
    transition: all 0.3s ease;
    margin-top: 20px;
  }

  .continue-btn {
    background-color: #ffc107;
    color: #333;
  }

  .continue-btn:hover {
    background-color: #e0a800;
    transform: translateY(-2px);
  }

  .view-order-btn {
    background-color: #007bff;
    color: white;
  }

  .view-order-btn:hover {
    background-color: #0069d9;
    transform: translateY(-2px);
  }

  .breadcrumb-content {
    display: flex;
    flex-direction: column;
  }

  .breadcrumb-content h2 {
    font-size: 30px;
    font-weight: 600;
    margin-bottom: 10px;
    color: #333;
  }

  .breadcrumb-content ol {
    display: flex;
    list-style: none;
    padding: 0;
    margin: 0;
    font-size: 14px;
  }

  .breadcrumb-content li + li:before {
    content: "›";
    padding: 0 8px;
    color: #777;
  }

  .breadcrumb-content a {
    color: #555;
    text-decoration: none;
    transition: color 0.3s;
  }

  .breadcrumb-content a:hover {
    color: #000000;
  }

  .shop-breadcrumb {
    padding: 20px 0;
    background-color: #f6f6f6;
    margin-bottom: 40px;
  }

  .payment-badge {
    display: inline-block;
    padding: 5px 10px;
    border-radius: 3px;
    font-size: 14px;
    font-weight: 500;
  }

  .payment-cod {
    background-color: #e9ecef;
    color: #495057;
  }

  .payment-razorpay {
    background-color: #007bff;
    color: white;
  }

  .payment-wallet {
    background-color: #28a745;
    color: white;
  }

  .status-badge {
    display: inline-block;
    padding: 5px 10px;
    border-radius: 3px;
    font-size: 14px;
    font-weight: 500;
  }

  .status-pending {
    background-color: #ffc107;
    color: #333;
  }

  .animate-success {
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.1);
    }
    100% {
      transform: scale(1);
    }
  }
</style>

<!-- Begin Breadcrumb Area -->
<div class="shop-breadcrumb">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="breadcrumb-content">
          <h2>Order Confirmation</h2>
          <ol>
            <li><a href="/">Home</a></li>
            <li><a href="/products">Shop</a></li>
            <li><a href="/cart">Cart</a></li>
            <li><a href="/checkout">Checkout</a></li>
            <li>Order Success</li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Breadcrumb Area End -->

<div class="container success-container">
  <div class="row">
    <div class="col-lg-8 mx-auto">
      <!-- Success Message Card -->
      <div class="success-card text-center">
        <i class="fas fa-check-circle success-icon animate-success"></i>
        <h1 class="display-4">Thank You!</h1>
        <p class="lead">Your order has been placed successfully.</p>

        <% if (orders.length > 1) { %>
        <p>Your orders have been split by seller for efficient processing.</p>
        <% } %>

        <div class="mt-4">
          <% orders.forEach((order, index) => { %>
          <div class="order-id">
            Order #<%= index + 1 %>: <strong><%= order.orderId %></strong>
          </div>
          <% }); %>
        </div>

        <p class="mt-3">
          A confirmation email has been sent to
          <strong><%= userEmail %></strong>
        </p>

        <div class="d-flex justify-content-center mt-4">
          <a href="/products" class="btn action-btn continue-btn mr-3">
            <i class="fas fa-shopping-bag mr-2"></i>Continue Shopping
          </a>
          <a href="/user/orders" class="btn action-btn view-order-btn">
            <i class="fas fa-clipboard-list mr-2"></i>View My Orders
          </a>
        </div>
      </div>

      <!-- Order Details Card -->
      <div class="success-card">
        <h2 class="section-title">Order Details</h2>

        <div class="row">
          <div class="col-md-6">
            <div class="info-row">
              <span class="info-label">Order Date:</span>
              <span
                ><%= new Date().toLocaleDateString('en-US', { year: 'numeric',
                month: 'long', day: 'numeric' }) %></span
              >
            </div>
            <div class="info-row">
              <span class="info-label">Payment Method:</span>
              <% let paymentBadgeClass = "payment-cod"; %> <% if
              (orders[0].paymentMethod === "razorpay") paymentBadgeClass =
              "payment-razorpay"; %> <% if (orders[0].paymentMethod ===
              "wallet") paymentBadgeClass = "payment-wallet"; %>
              <span class="payment-badge <%= paymentBadgeClass %>">
                <% if (orders[0].paymentMethod === "COD") { %>
                <i class="fas fa-money-bill-wave mr-1"></i> Cash on Delivery <%
                } else if (orders[0].paymentMethod === "razorpay") { %>
                <i class="fas fa-credit-card mr-1"></i> Online Payment <% } else
                if (orders[0].paymentMethod === "wallet") { %>
                <i class="fas fa-wallet mr-1"></i> Wallet Payment <% } %>
              </span>
            </div>
          </div>
          <div class="col-md-6">
            <div class="info-row">
              <span class="info-label">Order Status:</span>
              <span class="status-badge status-pending">
                <i class="fas fa-clock mr-1"></i> Pending
              </span>
            </div>
            <% if (orders[0].couponApplied) { %>
            <div class="info-row">
              <span class="info-label">Coupon Applied:</span>
              <span><i class="fas fa-tag mr-1"></i> Yes</span>
            </div>
            <% } %>
          </div>
        </div>

        <!-- Shipping Address -->
        <h3 class="order-details-title mt-4">Shipping Address</h3>
        <div class="address-box">
          <p class="mb-1"><strong><%= shippingAddress.name %></strong></p>
          <p class="mb-1"><%= shippingAddress.streetAddress %></p>
          <% if (shippingAddress.landMark) { %>
          <p class="mb-1"><%= shippingAddress.landMark %></p>
          <% } %>
          <p class="mb-1">
            <%= shippingAddress.city %>, <%= shippingAddress.state %> <%=
            shippingAddress.pincode %>
          </p>
          <p class="mb-1"><%= shippingAddress.country %></p>
          <p class="mb-0">Phone: <%= shippingAddress.phone %></p>
        </div>

        <!-- Order Items -->
        <h3 class="order-details-title">Order Items</h3>

        <% let totalItems = 0; %> <% orders.forEach(order => { %> <%
        order.orderedItems.forEach(item => { %> <% totalItems += item.quantity;
        %>
        <div class="order-item">
          <img
            src="/uploads/product-images/<%= item.product.productImage[0] %>"
            alt="<%= item.product.productName %>"
            class="product-image"
          />
          <div class="product-details">
            <h5 class="product-name">
              <%= item.product.productName.split('|')[0].trim() %>
              <span class="text-muted small">x<%= item.quantity %></span>
            </h5>
            <p class="product-category"><%= item.product.category.name %></p>
          </div>
          <div class="product-price">
            ₹ <%= (item.price * item.quantity).toFixed(2) %>
          </div>
        </div>
        <% }); %> <% }); %>

        <!-- Order Summary -->
        <h3 class="order-details-title">Order Summary</h3>

        <div class="order-summary-row">
          <span>Total Price (<%= totalItems %> items)</span>
          <span>₹ <%= totalAmount.totalRegularPrice.toFixed(2) %></span>
        </div>
        <div class="order-summary-row">
          <span>Disounted Subtotal (<%= totalItems %> items)</span>
          <span>₹ <%= totalAmount.subtotal.toFixed(2) %></span>
        </div>

        <div class="order-summary-row">
          <span>Shipping</span>
          <span>₹ <%= totalAmount.shipping.toFixed(2) %></span>
        </div>

        <% if (totalAmount.discount > 0) { %>
        <div class="order-summary-row">
          <span>Discount</span>
          <span class="text-success"
            >- ₹ <%= totalAmount.discount.toFixed(2) %></span
          >
        </div>
        <% } %>

        <div class="order-summary-row total-row">
          <span>Grand Total</span>
          <span>₹ <%= totalAmount.total.toFixed(2) %></span>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>

<%- include('../partials/footer.ejs') %>
